# 智能饮食管理系统后端实现文档

## 一、项目简介

本项目为“智能饮食管理系统”后端，基于 Spring Boot 框架开发，主要为前端小程序/网页等客户端提供用户登录、食物记录、体重管理、图片识别等RESTful API服务。项目采用分层架构，便于维护和扩展。

## 二、技术栈

Spring Boot 3.x
Spring Security（JWT认证）
Spring Data JPA（MySQL数据库）
Lombok
OkHttp（第三方API调用）
腾讯云COS（图片存储）
百度AI（食物图片识别）
Swagger（API文档）

## 三、主要模块与功能

### 1. 用户认证与管理
微信登录：通过前端传递的code，调用微信API获取openid，首次登录自动注册，返回JWT token。
JWT认证：所有需要登录的接口通过JWT进行身份校验。
用户信息管理：支持获取和更新用户昵称、性别、生日、身高等信息。

### 2. 食物记录
食物录入：用户可录入每日摄入的食物及重量，系统自动计算总卡路里。
食物数据初始化：启动时自动从Excel批量导入食物营养数据。
食物查询：支持食物模糊搜索、列表、数量统计等接口。

### 3. 体重管理
体重记录：用户可录入每日体重，支持历史数据查询。
体重目标：用户可设置体重目标，系统保存并可查询。

### 4. 图片识别
食物图片分析：用户上传食物图片，后端调用百度AI接口识别菜品，返回识别结果。
图片存储：图片上传至腾讯云COS，返回可访问的图片URL。

## 四、项目结构说明

```java
src/
 ├── main/
 │   ├── java/com/smartfood/backend/
 │   │    ├── controller/      // 控制器，API接口
 │   │    ├── dto/             // 数据传输对象
 │   │    ├── entity/          // 实体类（数据库表映射）
 │   │    ├── repository/      // JPA数据访问层
 │   │    ├── service/         // 业务逻辑层
 │   │    ├── security/        // 安全与认证
 │   │    └── config/          // 配置类
 │   └── resources/
 │        ├── application.properties // 配置文件
 │        └── data/                  // 食物数据Excel
```

## 五、核心流程说明

### 1. 微信登录流程
前端调用 /api/auth/login，传递微信登录code。
后端调用微信API获取openid，查库，无则注册新用户。
生成JWT token，返回给前端。

### 2. 食物记录流程
前端提交食物名称、重量、卡路里等信息。
后端保存记录，自动计算总卡路里。
支持查询用户历史食物记录和今日总卡路里。

### 3. 体重管理流程
前端提交体重数据，后端保存。
支持查询历史体重、设置和获取体重目标。

### 4. 图片识别流程
前端上传图片或Base64字符串。
后端调用百度AI识别食物，返回识别结果。
图片存储到腾讯云COS，返回图片URL。
